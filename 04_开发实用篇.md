# 开发实用篇

## 1. 热部署

关于热部署，有两个名词要理解，

- 重启，restart，自定义开发的代码，加载位置restart类加载器
- 重载，reload，jar包发生改变，加载位置base类加载器

前者在开发时，经常发生改变，而后者的变化频率不高，热部署就是解决重启的问题。

SpringBoot提供了热部署工具，

引入依赖，

![图 1](imgs/2023-05-02-15-38-37-image.png)  

在代码修改完成后，点击IDEA中的`Build Project`即可。

## 2. 高级配置

### 2.1 注解ConfigurationProperties

注解EnableConfigurationProperties和注解ConfigurationProperties的使用，它们可以为第三方Bean绑定属性，

![图 2](imgs/2023-05-02-16-51-27-image.png)  

### 2.2 宽松绑定

当使用注解ConfigurationProperties绑定属性时，支持属性名的**宽松绑定**，如下，

![图 3](imgs/2023-05-02-16-57-39-image.png)  

> **注意**
> 宽松绑定不支持注解Value引用单个属性的方式

另外，需要注意的是，注解ConfigurationProperties绑定的**前缀命名，仅能使用纯小写字母、数字、下划线作为合法的字符**。

### 2.3 配置的单位

在配置时间和存储空间时，单位容易产生误解，SpringBoot支持jdk8新的单位定义，如下，

```java
@DurationUnit(ChronoUnit.SECONDS)
private Duration serverTimeout;
@DataSizeUnit(DataUnit.MEGABYTES)
private DataSize dataSize;
```

可以通过注解规定配置数值的单位，也可以在配置文件中直接声明单位。

### 2.4 数据校验

配置时，可以使用数据格式校验，

添加依赖，

```xml
<!-- 校验接口 -->
<dependency>
    <groupId>jakarta.validation</groupId>
    <artifactId>jakarta.validation-api<artifactId>
</dependency>

<!-- 校验实现 -->
<dependency>
    <groupId>org.hibernate.validator</groupId>
    <artifactId>hibernate-validator</artifactId>
</dependency>
```

使用方式如下，在类上添加注解Validated，属性上添加校验规则，

```java
@Data
@Component
@ConfigurationProperties(prefix = "servers")
@Validated
public class ServerConfig {
    ...
    @Max(value = 8888, message = "最大值不能超过8888")
    @Min(value = 202, message = "最小值不能小于202")
    private int port;
    ...
}
```

支持的校验规则，可以查看jakarta.validation-api的jar包，hibernate-validator也额外提供了其他校验规则。

### 2.5 进制数据转换规则
